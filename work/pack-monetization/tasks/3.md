---
status: planned
depends_on: []
wave: 1
skills: [code-writing]
verify: bash
reviewers: [code-reviewer]
teammate_name:
---

# Task 3: Content generator updates

## Required Skills

Before executing, load:
- `/skill:code-writing` — [skills/code-writing/SKILL.md](~/.claude/skills/code-writing/SKILL.md)

## Description

Update the Python content generator pipeline to use 3 difficulty levels (easy/medium/hard) instead of 5 (beginner/easy/medium/hard/expert). This keeps the content generator in sync with the app's new difficulty model introduced by the pack-monetization feature.

Currently, `config.yaml` defines 5 difficulty levels with grid sizes ranging from 3x4 (beginner) to 10x13 (expert). The new model maps: lv1 (beginner, 3x4) becomes `easy`, lv3 (medium, 6x8) stays `medium`, lv5 (expert, 10x13) becomes `hard`. The intermediate levels lv2 (easy, 4x5) and lv4 (hard, 8x10) are dropped entirely.

Three files need updating: `config.yaml`, `generator.py`, and `maze_generator.py`. All references to the old 5-level difficulty names must be replaced with the 3-level system.

## What to do

1. **Update `content-generator/config.yaml`**:
   - Remove the `easy` (4x5 grid) and `hard` (8x10 grid) entries from `difficulty_levels` — these are the intermediate levels being dropped
   - Rename `beginner` to `easy` (keeping its 3x4 grid)
   - Keep `medium` unchanged (6x8 grid)
   - Rename `expert` to `hard` (keeping its 10x13 grid)
   - After the change, only 3 levels remain:
     - `easy`: grid_size [3, 4], path_width 40, path_tolerance 25, shapes ["rect"]
     - `medium`: grid_size [6, 8], path_width 30, path_tolerance 18, shapes ["rect"]
     - `hard`: grid_size [10, 13], path_width 22, path_tolerance 12, shapes ["rect"]
   - The `visual_themes` section is unchanged.

2. **Update `content-generator/generator.py`**:
   - Change `difficulty_names` lists from `["beginner", "easy", "medium", "hard", "expert"]` to `["easy", "medium", "hard"]` (appears in both `generate_difficulty_variants` at line 442 and `generate_adventure_variants` at line 752).
   - Update `ADVENTURE_ITEM_COUNTS` dict from 5 entries to 3: `{"easy": 2, "medium": 4, "hard": 6}`.
   - In `generate_difficulty_variants`: change `lv_idx` enumeration to start from 1 and produce `_easy`, `_medium`, `_hard` suffixes instead of `_lv1` through `_lv5`. Update `variant_id` construction from `f"{base_id}_lv{lv_idx}"` to `f"{base_id}_{diff_name}"`.
   - In `generate_adventure_variants`: same change to `variant_id` construction from `f"denny_{story_num_str}_lv{lv_idx}"` to `f"denny_{story_num_str}_{diff_name}"`.
   - Update the `--difficulty-variants` help text from "50 difficulty variants" to "30 difficulty variants" (10 stories x 3 levels).
   - Update the `--adventure-variants` help text from "50 adventure maze variants" to "30 adventure maze variants".
   - Update docstrings: `generate_difficulty_variants` says "50 labyrinth variants (10 stories x 5 difficulty levels)" -- change to "30 labyrinth variants (10 stories x 3 difficulty levels)".
   - Update docstrings: `generate_adventure_variants` says "50 adventure labyrinth variants (10 stories x 5 difficulty levels)" -- change to "30 adventure labyrinth variants (10 stories x 3 difficulty levels)".

3. **Update `content-generator/maze_generator.py`**:
   - Update `min_ratio` dict in `generate_maze` (line 626) from 5 entries to 3: `{"easy": 0.3, "medium": 0.4, "hard": 0.4}`.
   - Update `min_turns` dict (line 629) from 5 entries to 3: `{"easy": 3, "medium": 5, "hard": 7}`.
   - Update `extra_conns` dict (line 631) from 5 entries to 3: `{"easy": 1, "medium": 4, "hard": 8}`.

## Acceptance Criteria

- [ ] `config.yaml` has exactly 3 difficulty levels: easy, medium, hard
- [ ] No references to `beginner` or `expert` in any of the 3 files
- [ ] `ADVENTURE_ITEM_COUNTS` has exactly 3 entries (easy/medium/hard)
- [ ] `difficulty_names` lists in generator.py contain exactly `["easy", "medium", "hard"]`
- [ ] Variant IDs use `_{diff_name}` pattern (e.g. `denny_001_easy`) not `_lv{N}` pattern
- [ ] `min_ratio`, `min_turns`, `extra_conns` dicts in maze_generator.py have exactly 3 entries
- [ ] `python content-generator/generator.py --help` runs without errors
- [ ] Grid sizes preserved correctly: easy=3x4, medium=6x8, hard=10x13

## Context Files

- [user-spec.md](../user-spec.md)
- [tech-spec.md](../tech-spec.md)
- [decisions.md](../decisions.md)
- [project.md](~/.claude/skills/project-knowledge/references/project.md)
- [architecture.md](~/.claude/skills/project-knowledge/references/architecture.md)
- [config.yaml](../../../content-generator/config.yaml)
- [generator.py](../../../content-generator/generator.py)
- [maze_generator.py](../../../content-generator/maze_generator.py)

## Verification Steps

1. Run `python content-generator/generator.py --help` -- should exit 0 with no import errors (note: anthropic/dotenv imports may warn but the help flag exits before they're needed).
2. Grep all 3 files for `beginner` and `expert` -- expect 0 matches.
3. Grep `config.yaml` for difficulty level names -- expect exactly `easy`, `medium`, `hard`.
4. Verify `ADVENTURE_ITEM_COUNTS` has 3 keys by reading the line in generator.py.

## Details

**Files:**
- `content-generator/config.yaml` -- remove beginner + easy (old) entries, rename expert to hard. Keep easy (old beginner grid size), medium (unchanged), hard (old expert grid size).
- `content-generator/generator.py` -- update `difficulty_names` lists, `ADVENTURE_ITEM_COUNTS`, variant ID format, docstrings, help text.
- `content-generator/maze_generator.py` -- update `min_ratio`, `min_turns`, `extra_conns` dicts in `FullMazeGenerator.generate_maze()`.

**Mapping from old to new:**
| Old level | Old grid | New level | New grid |
|-----------|----------|-----------|----------|
| beginner  | 3x4      | easy      | 3x4      |
| easy      | 4x5      | (dropped) |          |
| medium    | 6x8      | medium    | 6x8      |
| hard      | 8x10     | (dropped) |          |
| expert    | 10x13    | hard      | 10x13    |

**Edge cases:**
- The `enumerate(difficulty_names, 1)` pattern in both variant generators used `lv_idx` for file naming. After the change, the loop variable `lv_idx` is no longer needed for naming -- just iterate with `diff_name` directly.
- The `generate_maze` method's `sizes` fallback dict (line 549-553) already only has easy/medium/hard, so no change needed there.

## Reviewers

- **code-reviewer** -> `logs/working/task-3/code-reviewer-{round}.json`

## Post-completion

- [ ] Record brief report in decisions.md (Summary: 1-3 sentences, review with links to JSON, no finding tables or dumps)
- [ ] If deviated from spec -- describe deviation and reason
- [ ] Update user-spec/tech-spec if anything changed
