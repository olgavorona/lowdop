---
status: planned
depends_on: []
wave: 1
skills: [code-writing]
verify: bash
reviewers: [code-reviewer]
teammate_name:
---

# Task 1: Content file changes

## Required Skills

Before starting, load:
- `/skill:code-writing` â€” [skills/code-writing/SKILL.md](~/.claude/skills/code-writing/SKILL.md)

## Description

Restructure the maze content files to support the new 3-level difficulty system (easy/medium/hard) and pack-based monetization model. This is the data foundation that all subsequent tasks depend on.

Currently there are 100 maze JSON files (20 stories x 5 difficulty levels: lv1/lv2/lv3/lv4/lv5) with difficulty values "beginner"/"easy"/"medium"/"hard"/"expert". The manifest has a flat structure with `total: 100`.

After this task:
- 40 files deleted (all lv2 and lv4 variants -- the intermediate difficulty levels that had too little difference from their neighbors)
- 60 remaining files renamed from `_lv1/_lv3/_lv5` to `_easy/_medium/_hard`
- Each JSON's `difficulty` field updated: `beginner` -> `easy`, `medium` stays `medium`, `expert` -> `hard`
- Each JSON's `id` field updated to match the new filename
- Each JSON's `path_data.complexity` field updated to match the new difficulty name
- `age_range` field removed from each JSON (no longer used)
- `manifest.json` restructured with pack support (60 entries, `packs` array, `story` field per entry)
- `difficulty_samples.json` reduced from 5 entries to 3 (keys: easy/medium/hard)

## What to do

### Step 1: Delete 40 lv2/lv4 files

Delete all files matching the patterns `denny_*_lv2.json` and `denny_*_lv4.json` in `LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/`. That is 20 lv2 files + 20 lv4 files = 40 files total.

Files to delete (all 40):
- `denny_001_lv2.json` through `denny_020_lv2.json` (20 files)
- `denny_001_lv4.json` through `denny_020_lv4.json` (20 files)

### Step 2: Rename 60 remaining files

Rename each remaining file using this mapping:
- `denny_XXX_lv1.json` -> `denny_XXX_easy.json`
- `denny_XXX_lv3.json` -> `denny_XXX_medium.json`
- `denny_XXX_lv5.json` -> `denny_XXX_hard.json`

This applies to all 20 stories (001-020), yielding 60 renamed files.

### Step 3: Update JSON fields inside each of the 60 files

For each renamed file, update these fields:

**In `_easy.json` files (formerly `_lv1.json`):**
- `"id": "denny_XXX_lv1"` -> `"id": "denny_XXX_easy"`
- `"difficulty": "beginner"` -> `"difficulty": "easy"`
- `"path_data"."complexity": "beginner"` -> `"path_data"."complexity": "easy"`
- Remove `"age_range": "3-4"` field entirely

**In `_medium.json` files (formerly `_lv3.json`):**
- `"id": "denny_XXX_lv3"` -> `"id": "denny_XXX_medium"`
- `"difficulty": "medium"` stays `"medium"` (no change needed)
- `"path_data"."complexity": "medium"` stays `"medium"` (no change needed)
- Remove `"age_range": "5-5"` field entirely (or whatever the current value is)

**In `_hard.json` files (formerly `_lv5.json`):**
- `"id": "denny_XXX_lv5"` -> `"id": "denny_XXX_hard"`
- `"difficulty": "expert"` -> `"difficulty": "hard"`
- `"path_data"."complexity": "expert"` -> `"path_data"."complexity": "hard"`
- Remove `"age_range": "6-6"` field entirely (or whatever the current value is)

### Step 4: Rewrite manifest.json

Replace the entire `manifest.json` with the new pack structure. The new format includes:

```json
{
  "universe": "denny",
  "total": 60,
  "packs": [
    {
      "id": "ocean_adventures",
      "title": "Ocean Adventures",
      "free_stories": 3,
      "stories": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
    }
  ],
  "labyrinths": [
    {"id": "denny_001_easy", "difficulty": "easy", "story": 1, "theme": "ocean", "location": "sandy_shore", "title": "Denny Finds Mommy Coral"},
    {"id": "denny_001_medium", "difficulty": "medium", "story": 1, "theme": "ocean", "location": "sandy_shore", "title": "Denny Finds Mommy Coral"},
    {"id": "denny_001_hard", "difficulty": "hard", "story": 1, "theme": "ocean", "location": "sandy_shore", "title": "Denny Finds Mommy Coral"},
    ...
  ]
}
```

Key changes from the current manifest:
- `total` changes from 100 to 60
- New top-level `packs` array with one pack (`ocean_adventures`)
- Each labyrinth entry gains a `"story": N` field (integer 1-20, derived from the XXX in the filename)
- Difficulty values updated: no more "beginner"/"easy"(old lv2)/"hard"(old lv4)/"expert" -- only "easy"/"medium"/"hard"
- IDs updated to match new filenames
- All 60 entries present, ordered by story then difficulty (easy/medium/hard)

Preserve existing `theme`, `location`, and `title` values from the current manifest for each story. The title/location/theme are the same across all difficulty levels of the same story.

### Step 5: Update difficulty_samples.json

Remove the `beginner` and `expert` keys. Remove the `easy` key (which was the old lv2 level) and the `hard` key (which was the old lv4 level). Keep only 3 entries with the new key names:

- `"easy"` -- use the SVG path data that was previously under `"beginner"` (this is the 3x4 grid maze)
- `"medium"` -- keep the existing `"medium"` SVG path data unchanged (this is the 6x8 grid maze)
- `"hard"` -- use the SVG path data that was previously under `"expert"` (this is the 10x13 grid maze)

## Acceptance Criteria

- [ ] 40 lv2/lv4 files deleted (0 files matching `denny_*_lv2.json` or `denny_*_lv4.json`)
- [ ] 60 files exist with correct names (`denny_XXX_easy.json`, `denny_XXX_medium.json`, `denny_XXX_hard.json` for XXX in 001-020)
- [ ] No files matching old names (`denny_*_lv1.json`, `denny_*_lv3.json`, `denny_*_lv5.json`)
- [ ] Each JSON's `id` field matches its filename (without `.json`)
- [ ] Each JSON's `difficulty` field is one of: "easy", "medium", "hard"
- [ ] Each JSON's `path_data.complexity` field matches its `difficulty` field
- [ ] No `age_range` field in any JSON file
- [ ] No references to "beginner" or "expert" in any content JSON file
- [ ] `manifest.json` has `total: 60`
- [ ] `manifest.json` has `packs` array with one entry (`ocean_adventures`, `free_stories: 3`, stories 1-20)
- [ ] `manifest.json` has 60 labyrinth entries, each with a `story` field (integer 1-20)
- [ ] `manifest.json` difficulty values are only "easy", "medium", "hard"
- [ ] `difficulty_samples.json` has exactly 3 keys: "easy", "medium", "hard"
- [ ] `difficulty_samples.json` "easy" contains the old "beginner" maze path (3x4 grid)
- [ ] `difficulty_samples.json` "hard" contains the old "expert" maze path (10x13 grid)

## Context Files

- [user-spec.md](../user-spec.md) -- acceptance criteria and constraints
- [tech-spec.md](../tech-spec.md) -- manifest structure, difficulty mapping, file naming
- [decisions.md](../decisions.md)
- [project.md](~/.claude/skills/project-knowledge/references/project.md) -- project overview
- [architecture.md](~/.claude/skills/project-knowledge/references/architecture.md) -- file structure, data model
- [patterns.md](~/.claude/skills/project-knowledge/references/patterns.md) -- conventions, ID ranges
- `LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/manifest.json` -- current manifest (100 entries)
- `LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/difficulty_samples.json` -- current samples (5 entries)
- `LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/denny_001_lv1.json` -- example JSON structure

## Verification Steps

Run the following bash commands to verify:

1. **File count check** -- exactly 60 maze JSON files remain:
   ```bash
   ls LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/denny_*.json | wc -l
   # Expected: 60
   ```

2. **No old lv1/lv2/lv3/lv4/lv5 files remain:**
   ```bash
   ls LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/denny_*_lv*.json 2>/dev/null | wc -l
   # Expected: 0
   ```

3. **Correct naming pattern** -- 20 easy + 20 medium + 20 hard:
   ```bash
   ls LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/denny_*_easy.json | wc -l
   # Expected: 20
   ls LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/denny_*_medium.json | wc -l
   # Expected: 20
   ls LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/denny_*_hard.json | wc -l
   # Expected: 20
   ```

4. **No old difficulty values in JSON content:**
   ```bash
   grep -rl '"beginner"' LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/denny_*.json | wc -l
   # Expected: 0
   grep -rl '"expert"' LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/denny_*.json | wc -l
   # Expected: 0
   ```

5. **No age_range field remains:**
   ```bash
   grep -rl 'age_range' LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/denny_*.json | wc -l
   # Expected: 0
   ```

6. **Manifest total is 60:**
   ```bash
   grep '"total": 60' LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/manifest.json
   # Expected: matches
   ```

7. **Manifest has packs array:**
   ```bash
   grep '"packs"' LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/manifest.json
   # Expected: matches
   ```

8. **Manifest has story fields:**
   ```bash
   grep -c '"story":' LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/manifest.json
   # Expected: 60
   ```

9. **difficulty_samples.json has exactly 3 keys:**
   ```bash
   python3 -c "import json; d=json.load(open('LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/difficulty_samples.json')); print(sorted(d.keys())); assert sorted(d.keys()) == ['easy', 'hard', 'medium']"
   # Expected: ['easy', 'hard', 'medium']
   ```

## Details

**Files to delete (40):**
All files in `LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/` matching:
- `denny_001_lv2.json` through `denny_020_lv2.json`
- `denny_001_lv4.json` through `denny_020_lv4.json`

**Files to rename (60):**
- `denny_XXX_lv1.json` -> `denny_XXX_easy.json` (for XXX = 001..020)
- `denny_XXX_lv3.json` -> `denny_XXX_medium.json` (for XXX = 001..020)
- `denny_XXX_lv5.json` -> `denny_XXX_hard.json` (for XXX = 001..020)

**Difficulty mapping (old -> new):**

| Old level | Old filename suffix | Old difficulty value | New filename suffix | New difficulty value |
|-----------|-------------------|---------------------|--------------------|--------------------|
| lv1 | `_lv1` | `beginner` | `_easy` | `easy` |
| lv2 | `_lv2` | `easy` | DELETED | DELETED |
| lv3 | `_lv3` | `medium` | `_medium` | `medium` |
| lv4 | `_lv4` | `hard` | DELETED | DELETED |
| lv5 | `_lv5` | `expert` | `_hard` | `hard` |

**Story-to-metadata mapping** (from current manifest, for rebuilding manifest.json):

| Story | Location | Title |
|-------|----------|-------|
| 1 | sandy_shore | Denny Finds Mommy Coral |
| 2 | coral_garden | Denny's Coral Garden Adventure |
| 3 | bubble_lagoon | Denny Finds Sandy's Bubbles |
| 4 | sandy_shore | Denny's Special Shell |
| 5 | starfish_cove | Denny's Glowing Rock Mystery |
| 6 | coral_garden | Denny Finds Shy Bubbles |
| 7 | kelp_forest | Denny Follows Shelly's Trail |
| 8 | kelp_forest | Denny Helps Find Ollie's Toy |
| 9 | shipwreck_playground | Denny's Shipwreck Adventure |
| 10 | bubble_lagoon | Denny Helps Pearl |
| 11 | sandy_shore | Denny's Shell Collection |
| 12 | coral_garden | Denny's Pearl Dive |
| 13 | bubble_lagoon | Denny's Bubble Chase |
| 14 | sandy_shore | Denny's Coral Bits |
| 15 | starfish_cove | Denny's Starfish Search |
| 16 | coral_garden | Denny's Clam Hunt |
| 17 | kelp_forest | Denny's Seaweed Harvest |
| 18 | kelp_forest | Denny's Kelp Harvest |
| 19 | shipwreck_playground | Denny's Treasure Hunt |
| 20 | bubble_lagoon | Denny's Coin Collection |

**JSON fields inside each maze file:**
- `id` -- string, matches filename without `.json`
- `difficulty` -- string, one of: "easy", "medium", "hard"
- `age_range` -- REMOVE this field entirely
- `path_data.complexity` -- string, must match `difficulty`
- All other fields remain unchanged

**difficulty_samples.json key mapping:**
- Old `"beginner"` value -> new `"easy"` key (3x4 grid, canvas ~580x460)
- Old `"medium"` value -> new `"medium"` key (6x8 grid, canvas ~580x460)
- Old `"expert"` value -> new `"hard"` key (10x13 grid, canvas ~580x465)
- Delete old `"easy"` key (was lv2 = 4x5 grid)
- Delete old `"hard"` key (was lv4 = 8x10 grid)

**Edge cases:**
- Stories 011-020 are "adventure" mazes with an `items` array. The items array should NOT be modified.
- The `visual_theme` block in each JSON should NOT be modified.
- Audio file references inside JSONs should NOT be modified (audio files are not renamed in this task).

## Reviewers

- **code-reviewer** -> `logs/working/task-1/code-reviewer-1.json`

## Post-completion

- [ ] Record brief summary in decisions.md (Summary: 1-3 sentences, review with links to JSON, no findings tables or dumps)
- [ ] If deviated from spec -- describe the deviation and reason
- [ ] Update user-spec/tech-spec if anything changed
