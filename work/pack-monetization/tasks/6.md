---
status: planned
depends_on: [2, 4]
wave: 3
skills: [code-writing]
verify: bash
reviewers: [code-reviewer]
teammate_name:
---

# Task 6: OnboardingView — 3 difficulty cards

## Required Skills

Before executing, load:
- `/skill:code-writing` — [skills/code-writing/SKILL.md](~/.claude/skills/code-writing/SKILL.md)

## Description

Reduce the onboarding screen from 5 difficulty cards to 3 (easy/medium/hard) and update navigation so that completing onboarding takes the user to the bookshelf screen instead of directly to the grid.

Currently, `OnboardingView` iterates over `DifficultyLevel.allCases` (5 cases: beginner/easy/medium/hard/expert) and renders a `DifficultyCard` for each. The `levelColors` dictionary has 5 entries with blue gradient pairs. Each `DifficultyCard` has a `levelNumber` computed property (1-5) used to fill difficulty dots (5 dots total). When the user taps a card, `preferences.hasCompletedOnboarding` is set to true, and `ContentView` transitions directly to `LabyrinthGridView`.

After task 2, the `DifficultyLevel` enum will have only 3 cases (easy/medium/hard), so `DifficultyLevel.allCases` will already yield 3 items. However, the view still needs explicit updates:
- The `levelColors` dictionary references `.beginner` and `.expert` which no longer exist — must be reduced to 3 entries.
- The `levelNumber` computed property in `DifficultyCard` maps 5 old cases — must be updated for 3.
- The difficulty dots indicator uses `ForEach(0..<5)` — must change to `ForEach(0..<3)`.
- Colors should be more differentiated (3 cards instead of 5, so wider color spread is better).
- Navigation change: after difficulty selection, the user should go to bookshelf (task 8 will wire this up in `ContentView`). For now, the onboarding still sets `hasCompletedOnboarding = true` and the actual routing is handled by `ContentView`.

## What to do

1. **Update `levelColors` dictionary** in `OnboardingView`:
   - Remove `.beginner` and `.expert` entries.
   - Keep only `.easy`, `.medium`, `.hard` with 3 distinct color gradient pairs.
   - Use a wider color spread since there are only 3 cards. Suggested palette (green-to-blue progression):
     - `.easy`: light/friendly greens (e.g. `#81C784` / `#66BB6A`)
     - `.medium`: warm oranges/ambers (e.g. `#FFB74D` / `#FFA726`)
     - `.hard`: deep blues or reds (e.g. `#EF5350` / `#E53935`)
   - The exact colors are at the implementer's discretion as long as they are visually distinct and child-friendly.

2. **Update `DifficultyCard.levelNumber`** computed property:
   - Remove `.beginner` and `.expert` cases.
   - Map: `.easy` -> 1, `.medium` -> 2, `.hard` -> 3.

3. **Update difficulty dots** in `DifficultyCard.body`:
   - Change `ForEach(0..<5, id: \.self)` to `ForEach(0..<3, id: \.self)`.
   - The fill condition `i < levelNumber` remains the same logic.

4. **Verify card layout**: With 3 cards instead of 5, the cards will naturally be wider (they use `frame(maxWidth: .infinity)` inside an HStack). No spacing changes should be needed, but verify the layout looks balanced.

5. **Keep analytics unchanged**: The `Analytics.send("Onboarding.difficultySelected")` call with `level.rawValue` still works — values will now be "easy", "medium", "hard".

6. **Keep navigation logic as-is for now**: Setting `preferences.hasCompletedOnboarding = true` is the trigger. Task 8 (BookshelfView + ContentView navigation) will change the routing from `LabyrinthGridView` to `BookshelfView` in `ContentView`. This task only modifies `OnboardingView.swift`.

## Acceptance Criteria

- [ ] `levelColors` dictionary has exactly 3 entries: `.easy`, `.medium`, `.hard`
- [ ] No references to `.beginner` or `.expert` in `OnboardingView.swift`
- [ ] `DifficultyCard.levelNumber` returns 1/2/3 for easy/medium/hard
- [ ] Difficulty dots indicator uses `ForEach(0..<3)` (3 dots, not 5)
- [ ] Colors are visually distinct across the 3 cards (not 5 shades of blue)
- [ ] Tapping a card still sets `preferences.difficultyLevel` and `preferences.hasCompletedOnboarding = true`
- [ ] Analytics event still fires with correct level rawValue
- [ ] `difficulty_samples.json` loading still works (will have 3 keys: easy/medium/hard after task 1)
- [ ] App builds successfully (`xcodebuild build`)

## Context Files

- [user-spec.md](../user-spec.md)
- [tech-spec.md](../tech-spec.md)
- [OnboardingView.swift](../../../LowDopamineLabyrinth/LowDopamineLabyrinth/Views/OnboardingView.swift) — the file to modify
- [ContentView.swift](../../../LowDopamineLabyrinth/LowDopamineLabyrinth/ContentView.swift) — navigation context (read only, modified by task 8)
- [difficulty_samples.json](../../../LowDopamineLabyrinth/LowDopamineLabyrinth/Resources/Labyrinths/difficulty_samples.json) — sample maze paths for card previews (modified by task 1)
- [UserPreferences.swift](../../../LowDopamineLabyrinth/LowDopamineLabyrinth/Models/UserPreferences.swift) — DifficultyLevel enum (modified by task 2)

## Verification Steps

1. Run `xcodebuild build` — expect BUILD SUCCEEDED.
2. Grep `OnboardingView.swift` for `beginner` and `expert` — expect 0 matches.
3. Grep `OnboardingView.swift` for `0..<5` — expect 0 matches (should be `0..<3`).
4. Verify `levelColors` has exactly 3 entries by reading the file.

## Details

**Files:**
- `LowDopamineLabyrinth/LowDopamineLabyrinth/Views/OnboardingView.swift` — update levelColors (remove 2 entries, change colors), update levelNumber (3 cases), update difficulty dots (3 instead of 5).

**Dependencies:**
- Task 2 (DifficultyLevel enum reduced to 3 cases) — without this, `.beginner`/`.expert` references still compile. This task removes those references from OnboardingView.
- Task 4 (LabyrinthLoader + StoryInfo) — ensures the data layer supports the new difficulty names for loading sample paths.
- Task 1 (content files) — `difficulty_samples.json` will have 3 entries. If task 1 is not done yet, the view still works but shows empty previews for missing keys.

**Edge cases:**
- If `difficulty_samples.json` still has 5 keys (task 1 not merged yet), `loadSamplePath` will still find entries for "easy", "medium", "hard" by key lookup. No crash.
- The `loadSamplePath` function decodes as `[String: String]` and looks up `level.rawValue` — this works regardless of extra keys in the JSON.
- With 3 wider cards, the mini maze preview aspect ratio (1.0) should still look fine — more horizontal space just means larger square previews.

**Implementation hints:**
- The `DifficultyLevel.allCases` iteration in the `ForEach` automatically adjusts to 3 items after task 2 — no code change needed in the `ForEach` itself.
- Consider whether the difficulty dots should use `Circle()` or a different indicator at 3 levels. Dots still work fine; 3 filled dots for hard gives a clear visual progression.

## Reviewers

- **code-reviewer** -> `logs/working/task-6/code-reviewer-{round}.json`

## Post-completion

- [ ] Record brief report in decisions.md (Summary: 1-3 sentences, review with links to JSON, no finding tables or dumps)
- [ ] If deviated from spec -- describe deviation and reason
- [ ] Update user-spec/tech-spec if anything changed
